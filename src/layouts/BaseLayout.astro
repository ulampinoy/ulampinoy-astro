---
import Navigation from "../components/Navigation.astro";
import Footer from "../components/Footer.astro";
import "../styles/main.css";

interface Props {
  title: string;
  description: string;
  showBackLink?: boolean;
}

const { title, description, showBackLink = true } = Astro.props;
const currentPath = Astro.url.pathname;
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Savate:wght@200..900&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="description" content={description} />
  </head>
  <body>
    <slot />
    <div class="container mx-auto max-w-6xl">
      <Navigation currentPath={currentPath} />
      {
        showBackLink && currentPath !== "/" && (
          <div class="px-4 py-12">
            <a
              href="/"
              class="inline-flex items-center text-amber-500 hover:text-amber-600 transition-colors"
              aria-label="Go back to home"
            >
              <svg
                class="w-5 h-5 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M10 19l-7-7m0 0l7-7m-7 7h18"
                />
              </svg>
              Go back
            </a>
          </div>
        )
      }
    </div>
    <Footer />
    
    {/* Anong Ulam Modal */}
    <div id="anong-ulam-modal" class="fixed inset-0 w-full h-full bg-black bg-opacity-50 z-[1000] flex items-center justify-center p-4 hidden">
      <div class="w-full max-w-md max-h-[90vh] overflow-y-auto">
        <div class="bg-white rounded-lg shadow-xl overflow-hidden">
          {/* Step 1: Previous Ulam */}
          <div id="step-1" class="p-6 step active">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-bold text-gray-800">Anong ulam mo kahapon?</h2>
              <button 
                onclick="document.getElementById('anong-ulam-modal').classList.add('hidden')" 
                class="text-gray-500 hover:text-gray-700"
              >
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            
            <div class="space-y-6">
              <div>
                <input
                  type="text"
                  id="previousUlam"
                  class="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                  placeholder="Hal. Adobong manok"
                  autofocus
                />
              </div>
              
              <button
                onclick="window.nextStep(1, 'previousUlam')"
                class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-lg transition-colors"
              >
                Sunod
              </button>
            </div>
          </div>
          
          {/* Step 2: Current Ulam */}
          <div id="step-2" class="p-6 step hidden">
            <div class="flex items-center mb-6">
              <button 
                onclick="prevStep(2)" 
                class="mr-3 text-gray-500 hover:text-amber-600"
              >
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
              </button>
              <h2 class="text-2xl font-bold text-gray-800">Anong ulam mo ngayon?</h2>
            </div>
            
            <div class="space-y-6">
              <div>
                <input
                  type="text"
                  id="currentUlam"
                  class="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                  placeholder="Hal. Sinigang na baboy"
                  autofocus
                />
              </div>
              
              <button
                onclick="nextStep(2, 'currentUlam')"
                class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-lg transition-colors"
              >
                Magrekomenda ng ulam
              </button>
            </div>
          </div>
          
          {/* Step 3: Loading */}
          <div id="step-3" class="p-8 text-center step hidden">
            <div class="animate-pulse space-y-6">
              <div class="w-16 h-16 mx-auto bg-amber-100 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </div>
              <p class="text-lg font-medium text-gray-700">Nag-iisip ng mga mungkahi...</p>
            </div>
          </div>
          
          {/* Step 4: Results */}
          <div id="step-4" class="step hidden">
            <div class="p-6">
              <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Mga mungkahing ulam</h2>
              </div>
              <div id="suggestions-list" class="space-y-3">
                <!-- Suggestions will be populated here -->
                
                <!-- Trending Ulam Option -->
                <div 
                  id="trending-option"
                  class="p-4 border border-amber-200 rounded-lg bg-amber-50 hover:bg-amber-100 cursor-pointer transition-colors flex items-center"
                  onclick="showTrendingUlam()"
                >
                  <div class="bg-amber-100 p-2 rounded-full mr-3">
                    <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                  </div>
                  <div>
                    <h3 class="font-medium text-amber-800">Tingnan ang Trending Ulam</h3>
                    <p class="text-xs text-amber-600">Mga sikat na luto ngayon sa YouTube</p>
                  </div>
                  <svg class="w-4 h-4 ml-auto text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </div>
              </div>
              <div id="trending-ulam" class="hidden space-y-4">
                <h4 class="font-medium text-amber-800">Trending Ulam sa YouTube</h4>
                <div id="trending-videos" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <!-- Trending videos will be loaded here -->
                  <div class="flex items-center p-3 bg-amber-50 rounded-lg">
                    <div class="w-24 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0">
                      <img src="" alt="" class="w-full h-full object-cover" id="thumb1">
                    </div>
                    <div class="ml-3 flex-1">
                      <a href="#" target="_blank" class="text-sm font-medium text-amber-700 hover:text-amber-900 line-clamp-2" id="title1"></a>
                      <p class="text-xs text-gray-500 mt-1" id="channel1"></p>
                    </div>
                  </div>
                  <div class="flex items-center p-3 bg-amber-50 rounded-lg">
                    <div class="w-24 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0">
                      <img src="" alt="" class="w-full h-full object-cover" id="thumb2">
                    </div>
                    <div class="ml-3 flex-1">
                      <a href="#" target="_blank" class="text-sm font-medium text-amber-700 hover:text-amber-900 line-clamp-2" id="title2"></a>
                      <p class="text-xs text-gray-500 mt-1" id="channel2"></p>
                    </div>
                  </div>
                  <div class="flex items-center p-3 bg-amber-50 rounded-lg">
                    <div class="w-24 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0">
                      <img src="" alt="" class="w-full h-full object-cover" id="thumb3">
                    </div>
                    <div class="ml-3 flex-1">
                      <a href="#" target="_blank" class="text-sm font-medium text-amber-700 hover:text-amber-900 line-clamp-2" id="title3"></a>
                      <p class="text-xs text-gray-500 mt-1" id="channel3"></p>
                    </div>
                  </div>
                  <div class="flex items-center p-3 bg-amber-50 rounded-lg">
                    <div class="w-24 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0">
                      <img src="" alt="" class="w-full h-full object-cover" id="thumb4">
                    </div>
                    <div class="ml-3 flex-1">
                      <a href="#" target="_blank" class="text-sm font-medium text-amber-700 hover:text-amber-900 line-clamp-2" id="title4"></a>
                      <p class="text-xs text-gray-500 mt-1" id="channel4"></p>
                    </div>
                  </div>
                </div>
              </div>
              <button
                onclick="resetForm()"
                class="w-full mt-6 px-4 py-2 bg-amber-100 hover:bg-amber-200 text-amber-800 font-medium rounded-lg transition-colors"
              >
                Magtanong muli
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Declare showTrendingUlam on window to fix TypeScript errors
      declare global {
        interface Window {
          showTrendingUlam: () => Promise<void>;
        }
      }

      // Form navigation functions
      window.nextStep = function(currentStep: number, inputId: string) {
        const input = document.getElementById(inputId) as HTMLInputElement;
        if (!input?.value.trim()) {
          input?.focus();
          return;
        }
        
        const currentStepEl = document.getElementById(`step-${currentStep}`);
        currentStepEl?.classList.add('hidden');
        
        if (currentStep === 2) {
          // Show loading state
          document.getElementById('step-3')?.classList.remove('hidden');
          // Simulate API call
          setTimeout(window.showResults, 1500);
        } else {
          const nextStepEl = document.getElementById(`step-${currentStep + 1}`);
          nextStepEl?.classList.remove('hidden');
          // Focus the next input if it exists
          const nextInput = nextStepEl?.querySelector('input');
          if (nextInput) nextInput.focus();
        }
      };
      
      window.prevStep = function(currentStep: number) {
        const currentStepEl = document.getElementById(`step-${currentStep}`);
        const prevStepEl = document.getElementById(`step-${currentStep - 1}`);
        
        if (currentStepEl && prevStepEl) {
          currentStepEl.classList.add('hidden');
          prevStepEl.classList.remove('hidden');
        }
      };
      
      window.showResults = function() {
        const previousUlam = (document.getElementById('previousUlam') as HTMLInputElement)?.value;
        const currentUlam = (document.getElementById('currentUlam') as HTMLInputElement)?.value;
        const suggestionsList = document.getElementById('suggestions-list');
        
        if (!suggestionsList) return;
        
        // Mock suggestions - these should match actual blog post slugs
        const suggestions = [
          { 
            name: 'Beef Kaldereta', 
            url: '/blog/beef-caldereta', 
            isLocal: true 
          },
          { 
            name: 'Pancit Guisado Special', 
            url: '/blog/pancit-guisado-special', 
            isLocal: true 
          },
          { 
            name: 'Chicken Adobo with Potato', 
            url: '/blog/chicken-adobo-potato', 
            isLocal: true 
          },
          { 
            name: 'Lumpiang Shanghai', 
            url: '/blog/lumpia-shanghai', 
            isLocal: true 
          },
          { 
            name: 'Fish Sinigang', 
            url: '/blog/fish-sinigang', 
            isLocal: true 
          }
        ];
        
        // Save the trending option HTML
        const trendingOption = document.getElementById('trending-option')?.outerHTML || '';
        
        // Display suggestions and re-add the trending option
        suggestionsList.innerHTML = suggestions.map(suggestion => `
          <a 
            href="${suggestion.url}" 
            ${suggestion.isLocal ? '' : 'target="_blank" rel="noopener noreferrer"'}
            class="block p-4 bg-amber-50 hover:bg-amber-100 rounded-lg transition-colors group"
          >
            <div class="flex items-center justify-between">
              <span class="text-amber-700 group-hover:text-amber-900 font-medium">
                ${suggestion.name}
                ${!suggestion.isLocal ? '<span class="text-xs text-amber-500 ml-2">(external)</span>' : ''}
              </span>
              <svg class="w-5 h-5 text-amber-400 group-hover:text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
          </a>
        `).join('') + trendingOption;
        
        // Re-attach the click event to the trending option
        const newTrendingOption = document.getElementById('trending-option');
        if (newTrendingOption) {
          newTrendingOption.onclick = window.showTrendingUlam;
        }
        
        document.getElementById('step-3')?.classList.add('hidden');
        document.getElementById('step-4')?.classList.remove('hidden');
      };
      
      window.resetForm = function() {
        // Reset form
        const prevInput = document.getElementById('previousUlam') as HTMLInputElement;
        const currInput = document.getElementById('currentUlam') as HTMLInputElement;
        
        if (prevInput) prevInput.value = '';
        if (currInput) currInput.value = '';
        
        // Reset UI
        document.querySelectorAll('.step').forEach(step => step.classList.add('hidden'));
        const firstStep = document.getElementById('step-1');
        if (firstStep) {
          firstStep.classList.remove('hidden');
          const firstInput = firstStep.querySelector('input');
          if (firstInput) firstInput.focus();
        }
      };
      
      // Show trending Filipino cooking videos
      window.showTrendingUlam = async function() {
        const trendingSection = document.getElementById('trending-ulam');
        const suggestionsList = document.getElementById('suggestions-list');
        const trendingOption = document.getElementById('trending-option');
        
        if (!trendingSection || !suggestionsList || !trendingOption) return;
        
        try {
          // Check if already showing trending section
          if (trendingSection.classList.contains('hidden')) {
            // Show loading state
            const originalContent = suggestionsList.innerHTML;
            suggestionsList.dataset.originalContent = originalContent;
            suggestionsList.innerHTML = '<div class="text-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-amber-500 mx-auto"></div><p class="mt-2 text-amber-700">Naglo-load ng trending ulam...</p></div>';
          
          // Curated list of trending Filipino cooking videos - one per creator
          const trendingVideos = [
            // YouTube Videos
            {
              title: 'PORK ADOBO - The Secret Recipe of Filipino Food',
              channel: 'Kusina ni Teds',
              videoId: '2S3-DbZFF0g', // Updated to a working video ID
              thumbnail: 'https://img.youtube.com/vi/2S3-DbZFF0g/mqdefault.jpg',
              platform: 'youtube',
              platformIcon: 'M10 16.5l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83c-.25.9-.83 1.48-1.73 1.73c-.47.13-1.33.22-2.65.28c-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8 0-8.83-.44c-.9-.25-1.48-.83-1.73-1.73c-.13-.47-.22-1.1-.28-1.9c-.07-.8-.1-1.49-.1-2.09L1 12c0-2.19.16-3.8.44-4.83c.25-.9.83-1.48 1.73-1.73c.47-.13 1.33-.22 2.65-.28c1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8 0 8.83.44c.9.25 1.48.83 1.73 1.73z',
              platformColor: 'text-red-500',
              views: '2.4M views',
              date: '3 weeks ago'
            },
            {
              title: 'SINIGANG NA BABOY - Best Pork Sinigang Recipe',
              channel: 'Panlasang Pinoy',
              videoId: 'XqZso55X2F4', // Updated to a working video ID
              thumbnail: 'https://img.youtube.com/vi/XqZso55X2F4/mqdefault.jpg',
              platform: 'youtube',
              platformIcon: 'M10 16.5l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83c-.25.9-.83 1.48-1.73 1.73c-.47.13-1.33.22-2.65.28c-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8 0-8.83-.44c-.9-.25-1.48-.83-1.73-1.73c-.13-.47-.22-1.1-.28-1.9c-.07-.8-.1-1.49-.1-2.09L1 12c0-2.19.16-3.8.44-4.83c.25-.9.83-1.48 1.73-1.73c.47-.13 1.33-.22 2.65-.28c1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8 0 8.83.44c.9.25 1.48.83 1.73 1.73z',
              platformColor: 'text-red-500',
              views: '1.8M views',
              date: '1 month ago'
            },
            // Instagram Reels
            {
              title: 'Crispy Pata Recipe - Filipino Style',
              channel: 'Lutong Bahay',
              videoId: 'Cxq6arK1YYY', // Using a valid YouTube ID for now
              thumbnail: 'https://images.unsplash.com/photo-1604909052743-94e838986d24?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80',
              platform: 'youtube', // Temporarily changed to YouTube
              platformIcon: 'M10 16.5l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83c-.25.9-.83 1.48-1.73 1.73c-.47.13-1.33.22-2.65.28c-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8 0-8.83-.44c-.9-.25-1.48-.83-1.73-1.73c-.13-.47-.22-1.1-.28-1.9c-.07-.8-.1-1.49-.1-2.09L1 12c0-2.19.16-3.8.44-4.83c.25-.9.83-1.48 1.73-1.73c.47-.13 1.33-.22 2.65-.28c1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8 0 8.83.44c.9.25 1.48.83 1.73 1.73z',
              platformColor: 'text-red-500',
              views: '1.2M views',
              date: '2 weeks ago'
            },
            {
              title: 'Easy Chicken Adobo - 15 Minute Recipe',
              channel: 'Filipino Foodie',
              videoId: 'dQw4w9WgXcQ', // Using a valid YouTube ID for now
              thumbnail: 'https://images.unsplash.com/photo-1589301760014-d929f3979dbc?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80',
              platform: 'youtube', // Temporarily changed to YouTube
              platformIcon: 'M10 16.5l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83c-.25.9-.83 1.48-1.73 1.73c-.47.13-1.33.22-2.65.28c-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8 0-8.83-.44c-.9-.25-1.48-.83-1.73-1.73c-.13-.47-.22-1.1-.28-1.9c-.07-.8-.1-1.49-.1-2.09L1 12c0-2.19.16-3.8.44-4.83c.25-.9.83-1.48 1.73-1.73c.47-.13 1.33-.22 2.65-.28c1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8 0 8.83.44c.9.25 1.48.83 1.73 1.73z',
              platformColor: 'text-red-500',
              views: '950K views',
              date: '3 weeks ago'
            }
          ];
          
          // Create HTML for trending videos
          const videosContainer = document.getElementById('trending-videos');
          if (videosContainer) {
            videosContainer.innerHTML = trendingVideos.map((video, index) => `
              <div class="bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                <a 
                  href="${video.platform === 'youtube' ? `https://www.youtube.com/watch?v=${video.videoId}` : `https://www.instagram.com/reel/${video.videoId}/`}" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="block relative group"
                >
                  <img 
                    src="${video.thumbnail}" 
                    alt="${video.title}" 
                    class="w-full h-40 object-cover"
                    loading="lazy"
                  >
                  <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                    <div class="bg-black bg-opacity-70 p-2 rounded-full">
                      <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                        <path d="${video.platformIcon}" />
                      </svg>
                    </div>
                  </div>
                </a>
                <div class="p-4">
                  <a 
                    href="${video.platform === 'youtube' ? `https://www.youtube.com/watch?v=${video.videoId}` : `https://www.instagram.com/reel/${video.videoId}/`}" 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="font-medium text-gray-900 hover:text-amber-600 transition-colors line-clamp-2"
                  >
                    ${video.title}
                  </a>
                  <p class="text-sm text-gray-500 mt-1">
                    ${video.channel}
                  </p>
                  <div class="flex items-center justify-between mt-2">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${video.platform === 'youtube' ? 'bg-red-100 text-red-800' : 'bg-pink-100 text-pink-800'}">
                      ${video.platform === 'youtube' ? 'YouTube' : 'Instagram'}
                    </span>
                    <span class="text-xs text-gray-500">
                      ${video.platform === 'youtube' ? video.views : video.likes + ' likes'}
                    </span>
                  </div>
                </div>
              </div>
            `).join('');
          }
          
          // Show trending section and hide suggestions
          suggestionsList.classList.add('hidden');
          trendingSection.classList.remove('hidden');
          
          // Add back button
          const backButton = `
            <div class="mb-6">
              <button 
                onclick="window.showTrendingUlam()"
                class="text-amber-600 hover:text-amber-800 font-medium flex items-center"
              >
                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Balik sa mga mungkahi
              </button>
              <h2 class="text-2xl font-bold text-gray-800 mt-2">Trending Ulam sa YouTube</h2>
            </div>`;
          
          trendingSection.insertAdjacentHTML('afterbegin', backButton);
          
        } else {
          // Toggle back to suggestions
          suggestionsList.classList.remove('hidden');
          trendingSection.classList.add('hidden');
          
          // Restore original content if available
          if (suggestionsList.dataset.originalContent) {
            suggestionsList.innerHTML = suggestionsList.dataset.originalContent;
            // Re-attach the click event to the trending option
            const newTrendingOption = document.getElementById('trending-option');
            if (newTrendingOption) {
              newTrendingOption.onclick = window.showTrendingUlam;
            }
          }
          }
        } catch (error) {
          console.error('Error in showTrendingUlam:', error);
          if (suggestionsList) {
            suggestionsList.innerHTML = '<p class="text-red-600 text-center py-4">May problema sa pag-load ng trending ulam. Subukan muli mamaya.</p>';
            suggestionsList.classList.remove('hidden');
          }
        }
      };

      // Initialize modal behavior
      document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('anong-ulam-modal');
        
        // Close modal when clicking outside content
        modal?.addEventListener('click', function(e) {
          if (e.target === this) {
            this.classList.add('hidden');
            window.resetForm();
          }
        });
        
        // Handle Enter key in inputs
        const inputs = document.querySelectorAll('#anong-ulam-modal input');
        inputs.forEach(input => {
          input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              e.preventDefault();
              const currentStep = this.closest('.step')?.id.split('-')[1];
              if (currentStep) {
                window.nextStep(parseInt(currentStep), this.id);
              }
            }
          });
        });
      });
    </script>
  </body>
</html>
